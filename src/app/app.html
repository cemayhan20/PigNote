<div class="app-container">
  <!-- Üst Toolbar -->
  <header class="app-toolbar">
    <div class="toolbar-left">
      <button class="toolbar-btn" (click)="toggleFilePanel()" [title]="t('toggleFilePanel')">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="4" width="18" height="16" rx="2" ry="2"></rect>
          <line x1="9" y1="4" x2="9" y2="20"></line>
        </svg>
      </button>
      <button class="toolbar-btn" (click)="exportContent()" title="Dışa Aktar" [disabled]="isExporting()">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" *ngIf="!isExporting()">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7,10 12,15 17,10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
        <svg class="icon loading-spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" *ngIf="isExporting()">
          <circle cx="12" cy="12" r="10" stroke-dasharray="31.416" stroke-dashoffset="31.416">
            <animate attributeName="stroke-dasharray" dur="2s" values="0 31.416;15.708 15.708;0 31.416" repeatCount="indefinite"/>
            <animate attributeName="stroke-dashoffset" dur="2s" values="0;-15.708;-31.416" repeatCount="indefinite"/>
          </circle>
        </svg>
       {{ isExporting() ? t('exporting') : t('export') }}
      </button>
      <button class="toolbar-btn save-btn" (click)="saveCurrentFile()" title="Kaydet">
        <ng-container *ngIf="!isSaving(); else savingSpinner">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
            <polyline points="17,21 17,13 7,13 7,21"></polyline>
            <polyline points="7,3 7,8 15,8"></polyline>
          </svg>
        </ng-container>
        <ng-template #savingSpinner>
          <svg class="icon loading-spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10" stroke-dasharray="31.416" stroke-dashoffset="31.416">
              <animate attributeName="stroke-dasharray" dur="1s" values="0 31.416;15.708 15.708;0 31.416" repeatCount="indefinite"/>
              <animate attributeName="stroke-dashoffset" dur="1s" values="0;-15.708;-31.416" repeatCount="indefinite"/>
            </circle>
          </svg>
        </ng-template>
       {{ t('save') }}
      </button>
    </div>
    
    <div class="toolbar-center">
      <div class="app-title-container">
        <span class="app-title">PigNote</span>
      </div>
    </div>
    
    <div class="toolbar-right">
      <button class="toolbar-btn" (click)="togglePreview()" [title]="t('previewToggle')">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
          <circle cx="12" cy="12" r="3"></circle>
        </svg>
        {{ t('preview') }}
      </button>
      <button class="toolbar-btn theme-toggle-btn" (click)="toggleTheme()" [title]="isDarkMode() ? t('themeDark') : t('themeLight')">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" *ngIf="!isDarkMode()">
          <circle cx="12" cy="12" r="5"/>
          <line x1="12" y1="1" x2="12" y2="3"/>
          <line x1="12" y1="21" x2="12" y2="23"/>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
          <line x1="1" y1="12" x2="3" y2="12"/>
          <line x1="21" y1="12" x2="23" y2="12"/>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
        </svg>
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" *ngIf="isDarkMode()">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
        </svg>
        <div class="toggle-track mini" [class.dark]="isDarkMode()">
          <div class="toggle-thumb mini" [class.dark]="isDarkMode()"></div>
        </div>
      </button>
      <button class="toolbar-btn" (click)="toggleSettings()" [title]="t('settings')">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M10.343 3.94c.09-.542.56-.94 1.11-.94h1.093c.55 0 1.02.398 1.11.94l.149.894c.11.657.75 1.06 1.39.889l.198-.053c.535-.144 1.112-.01 1.51.379l.773.773c.39.389.523.976.38 1.51l-.054.198c-.17.64.232 1.28.89 1.39l.893.149c.542.09.94.56.94 1.11v1.094c0 .55-.398 1.02-.94 1.11l-.893.149c-.658.11-1.06.75-.89 1.39l.054.198c.143.535.01 1.112-.38 1.51l-.773.773c-.398.389-.975.523-1.51.379l-.198-.053c-.64-.17-1.28.232-1.39.889l-.149.894c-.09.542-.56.94-1.11.94h-1.094c-.55 0-1.02-.398-1.11-.94l-.148-.894c-.11-.657-.75-1.06-1.39-.889l-.198.053c-.535.144-1.112.01-1.51-.379l-.773-.773a1.5 1.5 0 0 1-.38-1.51l.054-.198c.17-.64-.232-1.28-.89-1.39l-.894-.149A1.125 1.125 0 0 1 3 12.75v-1.094c0-.55.398-1.02.94-1.11l.894-.149c.658-.11 1.06-.75.89-1.39l-.054-.198a1.5 1.5 0 0 1 .38-1.51l.773-.773c.398-.389.975-.523 1.51-.379l.198.053c.64.17 1.28-.232 1.39-.889l.148-.894z"/>
          <path d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
        </svg>
        {{ t('settings') }}
      </button>
    </div>
  </header>

  <!-- Ana içerik alanı -->
  <main class="app-main">
    <!-- Sol panel - Dosya gezgini -->
    <aside class="file-panel" [class.collapsed]="!isFilePanelOpen()">
      <div class="panel-content">
        <app-file-explorer 
          [isOpen]="isFilePanelOpen()"
          [refreshTrigger]="refreshTrigger()"
          (fileSelected)="onFileSelected($event)"
          (saveRequested)="onSaveRequested($event)"
          (newFileRequested)="onNewFileRequested()"
          (newFolderRequested)="onNewFolderRequested()"
          (deleteFileRequested)="onDeleteFileRequested($event)"
          (currentPathChanged)="onCurrentPathChanged($event)"
          (refreshRequested)="onRefreshRequested()">
        </app-file-explorer>
        
        
      </div>
    </aside>
    <!-- Mobil: panel açıkken arka planı kaplayan karartma ve tıklayınca paneli kapat -->
    <div class="panel-backdrop" *ngIf="isFilePanelOpen()" (click)="toggleFilePanel()"></div>

    <!-- Sağ panel - Editör ve Önizleme -->
     <section class="editor-section">
      <app-editor
        [markdownText]="currentContent()"
        [showPreview]="showPreview()"
        [editorFontSize]="editorFontSize()"
        [previewFontSize]="editorFontSize()"
        (contentChanged)="onContentChanged($event)"
        (saveRequested)="onSaveRequested($event)">
      </app-editor>
          </section>
    <!-- Mobil: panel kapalıyken sol kenarda görünmez tıklama alanı ile paneli aç -->
    <div class="edge-hitbox" (click)="toggleFilePanel()"></div>
    </main>
  </div>

  <!-- Export Dialog -->
  <app-export-dialog 
    *ngIf="showExportDialog()"
    [defaultFilename]="getDefaultExportFilename()"
    (export)="onExport($event)"
    (cancel)="onExportCancel()">
  </app-export-dialog>

  <!-- New File Dialog -->
  <app-new-file-dialog 
    *ngIf="showNewFileDialog()"
    (create)="onNewFileCreate($event)"
    (cancel)="onNewFileCancel()">
  </app-new-file-dialog>

  <!-- New Folder Dialog -->
  <app-new-folder-dialog 
    *ngIf="showNewFolderDialog()"
    (create)="onNewFolderCreate($event)"
    (cancel)="onNewFolderCancel()">
  </app-new-folder-dialog>

  <!-- Delete File Dialog -->
  <app-delete-file-dialog 
    *ngIf="showDeleteFileDialog()"
    [options]="deleteFileOptions()"
    (delete)="onDeleteFileConfirm($event)"
    (cancel)="onDeleteFileCancel()">
  </app-delete-file-dialog>

  <!-- Export Loading Overlay -->
  <div class="export-loading-overlay" *ngIf="isExporting()">
    <div class="loading-content">
      <div class="loading-spinner-large">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10" stroke-dasharray="31.416" stroke-dashoffset="31.416">
            <animate attributeName="stroke-dasharray" dur="2s" values="0 31.416;15.708 15.708;0 31.416" repeatCount="indefinite"/>
            <animate attributeName="stroke-dashoffset" dur="2s" values="0;-15.708;-31.416" repeatCount="indefinite"/>
          </circle>
        </svg>
      </div>
      <p class="loading-text">{{ t('exporting') }}</p>
      <p class="loading-subtext">{{ t('pleaseWait') }}</p>
      <div class="loading-actions">
        <button class="toolbar-btn danger" (click)="cancelExport()">{{ t('cancel') }}</button>
      </div>
    </div>
  </div>

  <!-- Notifications -->
  <div class="notifications-container" [class.dark-theme]="isDarkMode()">
    <app-notification
      *ngFor="let notification of notifications(); let i = index"
      [options]="notification"
      (close)="removeNotification(i)">
    </app-notification>
  </div>

  <!-- Settings Dialog -->
  <app-settings-dialog 
    *ngIf="showSettingsDialog()"
    [appVersion]="appVersion"
    [language]="uiLanguage"
    [fontSize]="editorFontSize()"
    (close)="onSettingsClose()"
    (languageChange)="onLanguageChange($event)"
    (fontSizeChange)="onFontSizeChange($event)">
  </app-settings-dialog>
